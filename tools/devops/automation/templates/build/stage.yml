# template that contains all the different steps to create a pkgs, publish the results and provide feedback to the
# developers in github.
parameters:
- name: gitHubToken
  type: string

- job: build
  dependsOn:
  - AgentPoolSelector
  - configure
  displayName: 'Build packages'
  timeoutInMinutes: 1000
  variables:
    # old and ugly env var use by jenkins, we do have parts of the code that use it, contains the PR number
    PR_ID: 13377
    # set the branch variable name, this is required by jenkins and we have a lot of scripts that depend on it
    BRANCH_NAME: make-hang
  pool:
    name: VSEng-Xamarin-RedmondMacBuildPool-iOS-Untrusted
    demands:
    - Agent.OS -equals Darwin
    - macios_image -equals v2.1     # Big Sur image with Xcode 12.4 and 12.5 installed
  workspace:
    clean: all

  steps:
  - template: build.yml
    parameters:
      gitHubToken: ${{ parameters.gitHubToken }}

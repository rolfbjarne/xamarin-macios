<?xml version="1.0" encoding="utf-8"?>
<Project>
	<PropertyGroup>
		<OutputType>Exe</OutputType>

		<ApplicationTitle>MySimpleApp</ApplicationTitle>
		<ApplicationId>com.xamarin.mysimpleapp</ApplicationId>
		<ApplicationVersion>3.14</ApplicationVersion>
	</PropertyGroup>

	<Import Project="../../common/shared-dotnet.csproj" />

	<ItemGroup>
		<Compile Include="../*.cs" />
	</ItemGroup>

	<Target Name="CompressAppBundle" AfterTargets="Codesign" Condition="'$(IsMacEnabled)' == 'true' And '$(CopyAppBundleToWindows)' == 'true'">
		<PropertyGroup>
			<DirectoryToCompress Condition="'$(DirectoryToCompress)' == ''">$(_AppBundlePath)</DirectoryToCompress>
			<CompressedName Condition="'$(CompressedName)' == ''">AppBundle.zip</CompressedName>
			<CompressedPath Condition="'$(CompressedPath)' == ''">$(DeviceSpecificIntermediateOutputPath)$(CompressedName)</CompressedPath>
		</PropertyGroup>

		<GetFullPath SessionId="$(BuildSessionId)" Condition="'$(IsMacEnabled)' == 'true'" RelativePath="$(DirectoryToCompress)">
			<Output TaskParameter="FullPath" PropertyName="DirectoryToCompress" />
		</GetFullPath>

		<GetFullPath SessionId="$(BuildSessionId)" Condition="'$(IsMacEnabled)' == 'true'" RelativePath="$(CompressedPath)">
			<Output TaskParameter="FullPath" PropertyName="CompressedPath" />
		</GetFullPath>

		<MakeDir SessionId="$(BuildSessionId)" Directories="$([System.IO.Path]::GetDirectoryName('$(CompressedPath)'))" />
		<Delete SessionId="$(BuildSessionId)" Files="$(CompressedPath)" />

		<Zip
			SessionId="$(BuildSessionId)"
			Condition="'$(IsMacEnabled)' == 'true'"
			ToolExe="$(ZipExe)"
			ToolPath="$(ZipPath)"
			Recursive="true"
			Symlinks="true"
			Sources="$(DirectoryToCompress)"
			OutputFile="$(CompressedPath)"
			WorkingDirectory="$(DirectoryToCompress)"
			>
			<Output TaskParameter="OutputFile" ItemName="FileWrites" />
		</Zip>
	</Target>
</Project>
